<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>How to Verify Java Resource Paths with the Compiler</title>
  <link rel="stylesheet" href="../styles.css" type="text/css">
  <meta name="description" content="Tutorial demonstrating how to use uk.autores">
  <link rel="icon" href="../icons/favicon.png">
</head>

<body>

  <nav>
    <ul>
      <li><a href="..">HOME</a></li>
    </ul>
  </nav>

  <main>

    <h1>How to Verify Java Resource Paths with the Compiler</h1>

    <p>
      Code like <code>Hello.class.getResourceAsStream("foo.bin")</code> does not get evaluated until runtime.
      Worse, the method returns <code>null</code> if the resource is not found.
      This is not robust.
      Better to catch problems in the build process and get a meaningful error message.
    </p>

    <h2>Steps</h2>

    <ol>
      <li>
        <h3>Check out the base project</h3>
        <p>Follow the steps in <a href="helloworld.html">How to Set Up, Compile and Run an AutoRes.uk Project</a></p>
      </li>
      <li>
        <h3>Load some bytes using a stream</h3>
        <p>Replace the contents of <code>Hello.java</code> with:</p>
        <pre><code>package com.example;

<code>import uk.autores.handling.ResourceFiles;</code>                    
import java.io.IOException;
import java.io.InputStream;

<code>@ResourceFiles(Hello.FOO)</code>
public class Hello {
  static final String FOO = "foo.bin";

  public static void main(String[] args) throws IOException {
    try (InputStream in 
          = Hello.class.getResourceAsStream(FOO)) {
      byte[] buffer = new byte[64];
      int r;
      while ((r = in.read(buffer)) >= 0) {
        System.out.write(buffer, 0, r);
      }
    }
  }
}</code></pre>
        <p>Compile and run the application:</p>
        <pre><code>./mvnw --quiet clean compile exec:java</code></pre>
        <p>The contents of the file will be printed to the console.</p>
      </li>
      <li>
        <h3>Cause an error condition</h3>
        <p>Edit the constant to be a non-existant file:</p>
        <pre><code>  static final String FOO = "fooX.bin";</code></pre>
        <p>Recompile and run the application.</p>
        <p>Maven emits an error about the file not existing.</p>
      </li>
      <li>
        <h3>Make it simpler</h3>
        <p>
          The <code>FOO</code> constant was added to avoid putting the string in two places.
          This ensures they are always the same but is not ideal.
          Replace the code with:
        </p>
        <pre><code>package com.example;

<code>import uk.autores.InputStreams;</code>          
import java.io.IOException;
import java.io.InputStream;

<code>@InputStreams("foo.bin")</code>
public class Hello {
  public static void main(String[] args) throws IOException {
    try (InputStream in = <code>Example.foo()</code>) {
      byte[] buffer = new byte[64];
      int r;
      while ((r = in.read(buffer)) >= 0) {
        System.out.write(buffer, 0, r);
      }
    }
  }
}</code></pre>
        <p>Compile and run the application.</p>
        <p>
          The package name is used to generate the class name.
          Try altering how the resource class is generated by setting some annotation properties:
        </p>
        <pre><code>@InputStreams(
  value = {"foo.bin", "world.txt"},
  name = "ExampleResources",
  isPublic = true
)</code></pre>
      </li>
    </ol>

  </main>

  <footer>
    <nav>
        <ul>
            <li>Next: <a href="l10n.html">How to Improve Java Localization</a></li>
        </ul>
    </nav>
</footer>

</body>

</html>